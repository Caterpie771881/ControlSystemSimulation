# PW 矩阵求法

通过简单地分析系统结构图即可求得 P / W / W0 / Wc 矩阵

## P 系数矩阵

我们需要将系统各环节传递函数的参数填入 (填入顺序有要求)

以下面的结构图为例

```
       +~~~~~~~~+        +~~~~~+
    u1 | s + 10 | x1  u2 |  5  | x2
r ===> | ------ | =====> | --- | => y
       | 3s + 2 |        |  s  |
       +~~~~~~~~+        +~~~~~+
```

遵守从分母到分子、从低次幂到高次幂的顺序书写单个环节的参数

环节 1 的参数: `[2 3 10 1]`

环节 2 的参数: `[0 1 5 0]`

合并即可得到 P 矩阵
```matlab
P=[2 3 10 1;0 1 5 0];
```

### 包含非线性环节

当结构图包含非线性环节时, 需要添加 FZ, S 列

其中 FZ 的值由非线性环节的位置确定, 计算方式如下

|标志|说明|
|---|---|
|FZ=0|典型环节前后均无非线性环节|
|FZ=1|典型环节前有饱和非线性环节，应修正其输入u|
|FZ=2|典型环节前有死区非线性环节，应修正其输入u|
|FZ=3|典型环节前有滞环非线性环节，应修正其输入u|
|FZ=4|典型环节前有继电器非线性环节，应修正其输入u|
|FZ=5|典型环节后有饱和非线性环节，应修正其输出x|
|FZ=6|典型环节后有死区非线性环节，应修正其输出x|
|FZ=7|典型环节后有滞环非线性环节，应修正其输出x|
|FZ=8|典型环节后有继电器非线性环节，应修正其输出x|

其中 S 的值由非线性环节的系数确定

### 采样控制系统

在采样控制系统下, 默认包含非线性环节, 所以要把 FZ / S 列加上, 即使内容可能都是 0

并且涉及到一个新的非线性环节

FZ=9: 典型环节后有纯滞后非线性环节，应修正其输出x

该环节 S 列为其纯滞后时间

## W 连接矩阵, W0 输入矩阵, Wc 输出矩阵

用来表征各环节输入输出的连接关系

以下面的结构图为例

```
       +~~~~~~~~+        +~~~~~+        +~~~~~~~+
 (+) u1| s + 10 | x1  u2 |  5  | x2  u3 |   1   | x3
r =x=> | ------ | =====> | --- | =====> | ----- | ====> y
   ^(-)| 3s + 2 |        |  s  |        | s + 3 |   |
   |   +~~~~~~~~+        +~~~~~+        +~~~~~~~+   |
   +================================================+
```

对于 `r, u1, u2, u3, x1, x2, x3, y` 可以列出方程组

```
u1 = -1 * x3 + r
u2 = x1
u3 = x2
y  = x3
```

通过该方程组即可得到

```matlab
% W: 表征 ui 与 xi 的关系
W = [0 0 -1;
     1 0 0;
     0 1 0];
% W0: 表征 ui 与 r 的关系
% W0 是列向量
W0 = [1; 0; 0];
% Wc: 表征 y 与 ui 的关系
% Wc 是行向量
Wc = [0 0 1];
```

# 补充: Gr 和 Fr

对于数字型采样控制系统, 还需要输入 Gr 和 Fr 矩阵进行仿真

Gr: 数字控制器分子系数矩阵

Fr: 数字控制器分母系数矩阵

这两个矩阵需要通过 D(z) 函数得到 (观察参数即可)

公式为:

```
            g0 + g1*z^(-1) + ... + gm*z^(-m)
D(z) = -------------------------------------------
       1 + f1*z^(-1) + f2*z^(-2) + ... + fn*z^(-n)

Gr = [g0, g1, ..., gm]
Fr = [f1, f2, ..., fn]
```

例如对于下面的数字控制器
```
         2.72 - z^(-1)
D(z) = -----------------
       1 + 0.717 * z^(-1)
```

我们可以得到
```matlab
Gr=[2.72, -1];
Fr=[0.717];
```
